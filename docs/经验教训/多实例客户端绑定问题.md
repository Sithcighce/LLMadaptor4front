# å¤šå®ä¾‹ä¸­çš„å®¢æˆ·ç«¯ç»‘å®šé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

*æ–‡æ¡£åˆ›å»ºï¼š2025å¹´9æœˆ30æ—¥*

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

### ç”¨æˆ·ä½“éªŒç—›ç‚¹
> **å¼€å‘è€…å¾ˆå®¹æ˜“å¿˜è®°æ¯ä¸ªç»„ä»¶åº”è¯¥ç»‘å®šå“ªä¸ªclientï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šå®ä¾‹åœºæ™¯ä¸‹**

### å½“å‰æ¶æ„çš„æŒ‘æˆ˜

#### 1. **éšå¼ç»‘å®šé—®é¢˜** âš ï¸
```tsx
// å½“å‰çš„å¤šå®ä¾‹ä½¿ç”¨æ–¹å¼
function App() {
  return (
    <div>
      {/* æ€»ç»“åŠŸèƒ½åŒºåŸŸ */}
      <LlmConnectorProvider storageKey="summary-config">
        <SummaryComponent /> {/* è¿™ä¸ªç»„ä»¶ä½¿ç”¨å“ªä¸ªclientï¼Ÿä¸æ˜æ˜¾ï¼ */}
      </LlmConnectorProvider>
      
      {/* å¯¹è¯åŠŸèƒ½åŒºåŸŸ */}
      <LlmConnectorProvider storageKey="chat-config">
        <ChatComponent /> {/* è¿™ä¸ªç»„ä»¶åˆä½¿ç”¨å“ªä¸ªclientï¼Ÿ */}
      </LlmConnectorProvider>
    </div>
  );
}
```

**é—®é¢˜**ï¼š
- ğŸ”´ **ä¸ç›´è§‚** - ç»„ä»¶ä¸clientçš„ç»‘å®šå…³ç³»ä¸æ˜æ˜¾
- ğŸ”´ **å®¹æ˜“é”™è¯¯** - å¼€å‘è€…å¯èƒ½åœ¨é”™è¯¯çš„Providerä¸‹ä½¿ç”¨ç»„ä»¶
- ğŸ”´ **éš¾ä»¥è°ƒè¯•** - å½“å‡ºç°é—®é¢˜æ—¶å¾ˆéš¾å¿«é€Ÿå®šä½æ˜¯å“ªä¸ªclientçš„é—®é¢˜

#### 2. **ContextåµŒå¥—æ··ä¹±** âš ï¸
```tsx
// åµŒå¥—Provideræ—¶ï¼Œå†…éƒ¨ç»„ä»¶ä¼šæ„å¤–ä½¿ç”¨é”™è¯¯çš„client
<LlmConnectorProvider storageKey="summary-config">
  <div>
    <SummaryInterface />
    <LlmConnectorProvider storageKey="chat-config">
      <ChatInterface />
      <SharedComponent /> {/* è¿™é‡Œç”¨çš„æ˜¯chat-configï¼Œè€Œä¸æ˜¯summary-configï¼ */}
    </LlmConnectorProvider>
  </div>
</LlmConnectorProvider>
```

#### 3. **å¼€å‘å¿ƒæ™ºè´Ÿæ‹…é‡** âš ï¸
- éœ€è¦è®°ä½æ¯ä¸ªåŒºåŸŸçš„storageKeyå¯¹åº”çš„é…ç½®
- éœ€è¦ç¡®ä¿ç»„ä»¶åœ¨æ­£ç¡®çš„Providerå†…éƒ¨
- éš¾ä»¥é‡æ„å’Œç»„ä»¶å¤ç”¨

## ğŸ’¡ è§£å†³æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ1ï¼šæ˜¾å¼å®¢æˆ·ç«¯å‘½å â­â­â­â­â­
**æ ¸å¿ƒæ€è·¯**ï¼šä¸ºæ¯ä¸ªLLMå®ä¾‹æä¾›æ˜ç¡®çš„åç§°æ ‡è¯†

```tsx
// æ–°APIè®¾è®¡
<LlmConnectorProvider name="summary" storageKey="summary-config">
  <div className="summary-section">
    <h3>æ–‡æ¡£æ€»ç»“ (ä½¿ç”¨: summary)</h3>
    <ConnectionFormZh />
    <SummaryInterface />
  </div>
</LlmConnectorProvider>

<LlmConnectorProvider name="chat" storageKey="chat-config">
  <div className="chat-section">
    <h3>æ™ºèƒ½å¯¹è¯ (ä½¿ç”¨: chat)</h3>
    <ConnectionFormZh />
    <ChatInterface />
  </div>
</LlmConnectorProvider>
```

**ä½¿ç”¨æ—¶çš„æ”¹è¿›**ï¼š
```tsx
// ç»„ä»¶å†…éƒ¨å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯å“ªä¸ªclient
const SummaryInterface = () => {
  const { llmClient, instanceName } = useLlmConnector(); // instanceName = "summary"
  
  console.log(`ä½¿ç”¨çš„LLMå®ä¾‹: ${instanceName}`); // è°ƒè¯•å‹å¥½
  
  return (
    <div data-llm-instance={instanceName}> {/* DOMä¸­ä¹Ÿèƒ½çœ‹åˆ° */}
      {/* UI */}
    </div>
  );
};
```

### æ–¹æ¡ˆ2ï¼šç±»å‹å®‰å…¨çš„å®¢æˆ·ç«¯Hook â­â­â­â­
**æ ¸å¿ƒæ€è·¯**ï¼šä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸“ç”¨çš„Hook

```tsx
// ä¸“ç”¨Hookï¼Œæ˜ç¡®ç”¨é€”
export const useSummaryClient = () => {
  const { llmClient } = useLlmConnector();
  
  if (!llmClient) {
    console.warn('Summary LLM client not connected');
    return null;
  }
  
  return {
    summarize: async (text: string) => {
      return await llmClient.chat({
        messages: [{ role: 'user', content: `è¯·æ€»ç»“ä»¥ä¸‹å†…å®¹ï¼š${text}` }]
      });
    }
  };
};

export const useChatClient = () => {
  const { llmClient } = useLlmConnector();
  
  if (!llmClient) {
    console.warn('Chat LLM client not connected');
    return null;
  }
  
  return {
    chat: async (messages: ChatMessage[]) => {
      return await llmClient.chat({ messages });
    }
  };
};
```

**ä½¿ç”¨æ•ˆæœ**ï¼š
```tsx
const SummaryInterface = () => {
  const summaryClient = useSummaryClient(); // æ˜ç¡®çŸ¥é“è¿™æ˜¯æ€»ç»“client
  
  const handleSummarize = async (text: string) => {
    if (!summaryClient) return;
    const result = await summaryClient.summarize(text);
    // ...
  };
  
  return <div>{/* UI */}</div>;
};
```

### æ–¹æ¡ˆ3ï¼šç»Ÿä¸€å¤šå®ä¾‹ç®¡ç†å™¨ â­â­â­â­â­
**æ ¸å¿ƒæ€è·¯**ï¼šä¸€ä¸ªç»„ä»¶ç®¡ç†æ‰€æœ‰LLMå®ä¾‹ï¼Œé¿å…åµŒå¥—æ··ä¹±

```tsx
// æ–°çš„å¤šå®ä¾‹API
const MultiLlmManager = () => {
  const { clients, getInstance } = useMultiLlmClients({
    summary: {
      name: 'æ€»ç»“åŠ©æ‰‹',
      defaultConfig: { provider: 'openai', model: 'gpt-4o-mini' },
      storageKey: 'summary-config'
    },
    chat: {
      name: 'å¯¹è¯åŠ©æ‰‹', 
      defaultConfig: { provider: 'anthropic', model: 'claude-3-5-sonnet' },
      storageKey: 'chat-config'
    },
    translate: {
      name: 'ç¿»è¯‘åŠ©æ‰‹',
      defaultConfig: { provider: 'gemini', model: 'gemini-1.5-pro' },
      storageKey: 'translate-config'
    }
  });
  
  return (
    <div className="multi-llm-app">
      {/* é›†ä¸­é…ç½®åŒº */}
      <div className="config-panel">
        <h2>LLMé…ç½®ä¸­å¿ƒ</h2>
        {Object.entries(clients).map(([key, client]) => (
          <div key={key} className="instance-config">
            <h3>{client.name}</h3>
            <ConnectionForm instanceId={key} />
            <div>çŠ¶æ€: {client.status}</div>
          </div>
        ))}
      </div>
      
      {/* åŠŸèƒ½åŒºåŸŸ */}
      <div className="function-areas">
        <SummaryInterface client={getInstance('summary')} />
        <ChatInterface client={getInstance('chat')} />
        <TranslateInterface client={getInstance('translate')} />
      </div>
    </div>
  );
};
```

**ç»„ä»¶ä½¿ç”¨**ï¼š
```tsx
// æ˜¾å¼ä¼ é€’clientï¼Œç»‘å®šå…³ç³»ä¸€ç›®äº†ç„¶
const SummaryInterface = ({ client }: { client: LlmClientInstance }) => {
  const handleSummarize = async (text: string) => {
    if (!client.isConnected) {
      console.warn('Summary client not connected');
      return;
    }
    
    const result = await client.chat({
      messages: [{ role: 'user', content: `è¯·æ€»ç»“ï¼š${text}` }]
    });
    
    return result.text;
  };
  
  return (
    <div data-client-name={client.name}>
      <h3>ä½¿ç”¨å®¢æˆ·ç«¯: {client.name}</h3>
      {/* UI */}
    </div>
  );
};
```

### æ–¹æ¡ˆ4ï¼šå¯è§†åŒ–è°ƒè¯•å·¥å…· â­â­â­
**æ ¸å¿ƒæ€è·¯**ï¼šæä¾›å¼€å‘æ—¶çš„è°ƒè¯•é¢æ¿ï¼Œæ˜¾ç¤ºclientç»‘å®šå…³ç³»

```tsx
// å¼€å‘æ¨¡å¼ä¸‹çš„è°ƒè¯•ç»„ä»¶
const LlmDebugPanel = () => {
  const instances = useLlmInstances(); // è·å–æ‰€æœ‰å®ä¾‹ä¿¡æ¯
  
  return (
    <div className="llm-debug-panel" style={{ 
      position: 'fixed', 
      top: 0, 
      right: 0, 
      background: 'rgba(0,0,0,0.8)',
      color: 'white',
      padding: '10px',
      zIndex: 9999
    }}>
      <h4>LLMå®ä¾‹çŠ¶æ€</h4>
      {instances.map(instance => (
        <div key={instance.id}>
          <strong>{instance.name}</strong>: {instance.status}
          <br />
          æ¨¡å‹: {instance.model}
          <br />
          ç»„ä»¶æ•°: {instance.connectedComponents.length}
        </div>
      ))}
    </div>
  );
};

// ä½¿ç”¨
function App() {
  return (
    <div>
      {process.env.NODE_ENV === 'development' && <LlmDebugPanel />}
      {/* å…¶ä»–ç»„ä»¶ */}
    </div>
  );
}
```

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### é˜¶æ®µ1ï¼šç«‹å³æ”¹è¿› - æ˜¾å¼å‘½å (1å¤©)
```tsx
// å½“å‰å¯ä»¥ç«‹å³å®æ–½çš„æ”¹è¿›
export const LlmConnectorProvider: React.FC<{
  children: ReactNode;
  name?: string;        // æ–°å¢ï¼šå®ä¾‹åç§°
  storageKey?: string;  // ç°æœ‰ï¼šå­˜å‚¨é”®
}> = ({ children, name, storageKey }) => {
  const logic = useLlmConnectorLogic();
  
  // åœ¨contextä¸­æ·»åŠ å®ä¾‹åç§°
  const contextValue = useMemo(() => ({
    ...logic,
    instanceName: name || 'default'
  }), [logic, name]);
  
  return (
    <LlmConnectorContext.Provider value={contextValue}>
      {children}
    </LlmConnectorContext.Provider>
  );
};
```

### é˜¶æ®µ2ï¼šHookæ”¹è¿› - ä¸“ç”¨Hook (2å¤©)
```tsx
// ä¸ºå¸¸è§ç”¨ä¾‹åˆ›å»ºä¸“ç”¨Hook
export const createLlmHook = (purpose: string) => {
  return () => {
    const { llmClient, instanceName } = useLlmConnector();
    
    if (!llmClient) {
      console.warn(`${purpose} LLM client (${instanceName}) not connected`);
      return null;
    }
    
    return {
      client: llmClient,
      instanceName,
      purpose,
      isConnected: !!llmClient
    };
  };
};

// é¢„å®šä¹‰çš„ä¸“ç”¨Hook
export const useSummaryLlm = createLlmHook('Summary');
export const useChatLlm = createLlmHook('Chat');
export const useTranslateLlm = createLlmHook('Translate');
```

### é˜¶æ®µ3ï¼šå¤šå®ä¾‹ç®¡ç†å™¨ (5å¤©)
```tsx
// å®Œæ•´çš„å¤šå®ä¾‹ç®¡ç†ç³»ç»Ÿ
export const useMultiLlmClients = (config: MultiLlmConfig) => {
  // å®ç°ç»Ÿä¸€çš„å¤šå®ä¾‹ç®¡ç†é€»è¾‘
};
```

## ğŸ“Š ç”¨æˆ·ä½“éªŒå¯¹æ¯”

| æ–¹æ¡ˆ | å¼€å‘å¤æ‚åº¦ | ç»‘å®šæ¸…æ™°åº¦ | è°ƒè¯•å‹å¥½æ€§ | é‡æ„å®¹æ˜“åº¦ | æ¨èæŒ‡æ•° |
|------|------------|------------|------------|------------|----------|
| ç°çŠ¶ | ä½ | â­â­ | â­â­ | â­â­ | â­â­ |
| æ˜¾å¼å‘½å | ä½ | â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| ä¸“ç”¨Hook | ä¸­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| ç»Ÿä¸€ç®¡ç†å™¨ | é«˜ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| è°ƒè¯•å·¥å…· | ä¸­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ | â­â­â­ |

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. **å‘½åè§„èŒƒ**
```tsx
// å»ºè®®çš„å®ä¾‹å‘½åè§„èŒƒ
<LlmConnectorProvider name="summary-gpt4mini" storageKey="summary-config">
<LlmConnectorProvider name="chat-claude" storageKey="chat-config">
<LlmConnectorProvider name="translate-gemini" storageKey="translate-config">
```

### 2. **ç»„ä»¶æ ‡è®°**
```tsx
// åœ¨ç»„ä»¶ä¸­æ˜ç¡®æ ‡è®°ä½¿ç”¨çš„client
const SummaryComponent = () => {
  const { llmClient, instanceName } = useLlmConnector();
  
  return (
    <div 
      data-llm-instance={instanceName}
      className={`summary-component using-${instanceName}`}
    >
      <div className="client-indicator">
        ä½¿ç”¨: {instanceName} {llmClient ? 'âœ…' : 'âŒ'}
      </div>
      {/* åŠŸèƒ½UI */}
    </div>
  );
};
```

### 3. **é”™è¯¯æç¤ºä¼˜åŒ–**
```tsx
// æ›´å‹å¥½çš„é”™è¯¯æç¤º
const useClientWithValidation = (expectedPurpose: string) => {
  const { llmClient, instanceName } = useLlmConnector();
  
  if (!llmClient) {
    throw new Error(
      `LLM Client not connected for ${expectedPurpose}. ` +
      `Current instance: ${instanceName}. ` +
      `Please check your LlmConnectorProvider configuration.`
    );
  }
  
  return llmClient;
};
```

## ğŸ¯ ç»“è®º

**æ ¸å¿ƒé—®é¢˜ç¡®å®å­˜åœ¨**ï¼Œå½“å‰çš„éšå¼ç»‘å®šæ¨¡å¼åœ¨å¤šå®ä¾‹åœºæ™¯ä¸‹ç”¨æˆ·ä½“éªŒä¸ä½³ã€‚

**æ¨èçš„è§£å†³æ–¹æ¡ˆ**ï¼š
1. **ç«‹å³å®æ–½** - æ˜¾å¼å‘½å (æœ€é«˜æ€§ä»·æ¯”)
2. **ä¸­æœŸè§„åˆ’** - ä¸“ç”¨Hook (æœ€ä½³ç”¨æˆ·ä½“éªŒ)
3. **é•¿æœŸç›®æ ‡** - ç»Ÿä¸€ç®¡ç†å™¨ (æœ€å®Œæ•´æ–¹æ¡ˆ)

è¿™ä¸ªæ”¹è¿›å°†å¤§å¤§æå‡å¤šå®ä¾‹ä½¿ç”¨çš„å¼€å‘ä½“éªŒï¼Œè®©clientç»‘å®šå…³ç³»å˜å¾—æ¸…æ™°æ˜ç¡®ï¼