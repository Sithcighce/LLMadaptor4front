# å‘½åå®ä¾‹ç®¡ç† - å…·ä½“å®ç°ç¤ºä¾‹

*æ–‡æ¡£åˆ›å»ºï¼š2025å¹´9æœˆ30æ—¥*

## ğŸ¯ æ ¸å¿ƒæ€è·¯ï¼šé€šè¿‡åå­—ç®¡ç†ä¸åŒå®ä¾‹

### åŸºæœ¬æ¦‚å¿µ
æ¯ä¸ª`LlmConnectorProvider`éƒ½æœ‰ä¸€ä¸ª`name`å±æ€§ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªå®ä¾‹çš„ç”¨é€”ã€‚ç»„ä»¶é€šè¿‡`useLlmConnector()`å¯ä»¥è·å–åˆ°å½“å‰å®ä¾‹çš„åå­—å’Œå¯¹åº”çš„clientã€‚

## ğŸ› ï¸ å®ç°æ–¹æ¡ˆ

### ç¬¬ä¸€æ­¥ï¼šæ‰©å±• LlmConnectorProvider

```tsx
// src/providers/LlmConnectorProvider.tsx
export const LlmConnectorProvider: React.FC<{
  children: ReactNode;
  name?: string;        // ğŸ†• å®ä¾‹åç§°
  storageKey?: string;  // ç°æœ‰ï¼šå­˜å‚¨é”®
}> = ({ children, name = 'default', storageKey }) => {
  const logic = useLlmConnectorLogic();
  
  // åœ¨contextä¸­æ·»åŠ å®ä¾‹åç§°
  const contextValue = useMemo(() => ({
    ...logic,
    instanceName: name
  }), [logic, name]);
  
  return (
    <LlmConnectorContext.Provider value={contextValue}>
      {children}
    </LlmConnectorContext.Provider>
  );
};
```

### ç¬¬äºŒæ­¥ï¼šæ›´æ–° Context ç±»å‹

```tsx
// src/contexts/LlmConnectorContext.ts
export type LlmConnectorContextType = ReturnType<typeof useLlmConnectorLogic> & {
  instanceName: string; // ğŸ†• å®ä¾‹åç§°
};
```

### ç¬¬ä¸‰æ­¥ï¼šå…·ä½“ä½¿ç”¨ç¤ºä¾‹

```tsx
// App.tsx - å¤šå®ä¾‹ç®¡ç†
function AIWorkspace() {
  return (
    <div className="ai-workspace">
      {/* ğŸ“„ æ–‡æ¡£æ€»ç»“åŒºåŸŸ - ä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ */}
      <LlmConnectorProvider 
        name="document-summary" 
        storageKey="summary-llm-config"
      >
        <section className="summary-area">
          <h2>ğŸ“„ æ–‡æ¡£æ€»ç»“åŠ©æ‰‹</h2>
          <p>æ¨èæ¨¡å‹: GPT-4o Mini (ç»æµæ¨¡å¼)</p>
          <ConnectionFormZh />
          <DocumentSummary />
        </section>
      </LlmConnectorProvider>

      {/* ğŸ’¬ æ™ºèƒ½å¯¹è¯åŒºåŸŸ - ä½¿ç”¨é«˜è´¨é‡æ¨¡å‹ */}
      <LlmConnectorProvider 
        name="intelligent-chat" 
        storageKey="chat-llm-config"
      >
        <section className="chat-area">
          <h2>ğŸ’¬ æ™ºèƒ½å¯¹è¯åŠ©æ‰‹</h2>
          <p>æ¨èæ¨¡å‹: Claude-3.5 Sonnet (é«˜è´¨é‡æ¨¡å¼)</p>
          <ConnectionFormZh />
          <IntelligentChat />
        </section>
      </LlmConnectorProvider>

      {/* ğŸŒ å¤šè¯­è¨€ç¿»è¯‘åŒºåŸŸ - ä½¿ç”¨å¤šè¯­è¨€å¼ºçš„æ¨¡å‹ */}
      <LlmConnectorProvider 
        name="multi-translate" 
        storageKey="translate-llm-config"
      >
        <section className="translate-area">
          <h2>ğŸŒ å¤šè¯­è¨€ç¿»è¯‘åŠ©æ‰‹</h2>
          <p>æ¨èæ¨¡å‹: Gemini-1.5 Pro (å¤šè¯­è¨€å¼º)</p>
          <ConnectionFormZh />
          <MultiLanguageTranslate />
        </section>
      </LlmConnectorProvider>
    </div>
  );
}

// DocumentSummary.tsx - æ€»ç»“ç»„ä»¶
const DocumentSummary = () => {
  const { llmClient, instanceName, states } = useLlmConnector();
  const [document, setDocument] = useState('');
  const [summary, setSummary] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSummarize = async () => {
    if (!llmClient) {
      alert(`${instanceName} å®ä¾‹æœªè¿æ¥ï¼Œè¯·å…ˆé…ç½®è¿æ¥`);
      return;
    }

    setIsLoading(true);
    try {
      const result = await llmClient.chat({
        messages: [
          { role: 'system', content: 'ä½ æ˜¯ä¸“ä¸šçš„æ–‡æ¡£æ€»ç»“åŠ©æ‰‹ï¼Œè¯·æä¾›ç®€æ´å‡†ç¡®çš„æ€»ç»“' },
          { role: 'user', content: `è¯·æ€»ç»“ä»¥ä¸‹æ–‡æ¡£å†…å®¹ï¼š\n\n${document}` }
        ]
      });
      
      setSummary(result.text);
      console.log(`âœ… ${instanceName} æ€»ç»“å®Œæˆ`);
    } catch (error) {
      console.error(`âŒ ${instanceName} æ€»ç»“å¤±è´¥:`, error);
      alert(`${instanceName} æ€»ç»“å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="document-summary" data-instance={instanceName}>
      {/* å®ä¾‹çŠ¶æ€æŒ‡ç¤ºå™¨ */}
      <div className="instance-status">
        <span className="instance-name">å®ä¾‹: {instanceName}</span>
        <span className={`status ${states.status}`}>
          {states.status === 'connected' ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}
        </span>
        {states.status === 'connected' && (
          <span className="model">æ¨¡å‹: {states.model}</span>
        )}
      </div>

      {/* åŠŸèƒ½ç•Œé¢ */}
      <div className="summary-interface">
        <textarea
          value={document}
          onChange={(e) => setDocument(e.target.value)}
          placeholder="è¯·è¾“å…¥éœ€è¦æ€»ç»“çš„æ–‡æ¡£å†…å®¹..."
          rows={8}
          className="document-input"
        />
        
        <button 
          onClick={handleSummarize}
          disabled={!document.trim() || !llmClient || isLoading}
          className="summarize-button"
        >
          {isLoading ? 'ğŸ¤” æ€»ç»“ä¸­...' : 'ğŸ“„ å¼€å§‹æ€»ç»“'}
        </button>

        {summary && (
          <div className="summary-result">
            <h4>ğŸ“‹ æ€»ç»“ç»“æœï¼š</h4>
            <div className="summary-content">{summary}</div>
          </div>
        )}
      </div>
    </div>
  );
};

// IntelligentChat.tsx - å¯¹è¯ç»„ä»¶
const IntelligentChat = () => {
  const { llmClient, instanceName, states } = useLlmConnector();
  const [messages, setMessages] = useState<Array<{role: string, content: string}>>([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSendMessage = async () => {
    if (!llmClient) {
      alert(`${instanceName} å®ä¾‹æœªè¿æ¥ï¼Œè¯·å…ˆé…ç½®è¿æ¥`);
      return;
    }

    const userMessage = { role: 'user', content: input };
    const newMessages = [...messages, userMessage];
    setMessages(newMessages);
    setInput('');
    setIsLoading(true);

    try {
      const result = await llmClient.chat({
        messages: [
          { role: 'system', content: 'ä½ æ˜¯æ™ºèƒ½å¯¹è¯åŠ©æ‰‹ï¼Œè¯·æä¾›æœ‰å¸®åŠ©çš„å›ç­”' },
          ...newMessages
        ]
      });
      
      setMessages([...newMessages, { role: 'assistant', content: result.text }]);
      console.log(`âœ… ${instanceName} å¯¹è¯å“åº”å®Œæˆ`);
    } catch (error) {
      console.error(`âŒ ${instanceName} å¯¹è¯å¤±è´¥:`, error);
      alert(`${instanceName} å¯¹è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="intelligent-chat" data-instance={instanceName}>
      {/* å®ä¾‹çŠ¶æ€æŒ‡ç¤ºå™¨ */}
      <div className="instance-status">
        <span className="instance-name">å®ä¾‹: {instanceName}</span>
        <span className={`status ${states.status}`}>
          {states.status === 'connected' ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}
        </span>
        {states.status === 'connected' && (
          <span className="model">æ¨¡å‹: {states.model}</span>
        )}
      </div>

      {/* å¯¹è¯ç•Œé¢ */}
      <div className="chat-interface">
        <div className="messages">
          {messages.map((msg, index) => (
            <div key={index} className={`message ${msg.role}`}>
              <div className="role">{msg.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
              <div className="content">{msg.content}</div>
            </div>
          ))}
          {isLoading && (
            <div className="message assistant loading">
              <div className="role">ğŸ¤–</div>
              <div className="content">æ€è€ƒä¸­...</div>
            </div>
          )}
        </div>

        <div className="input-area">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
            onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
            disabled={isLoading}
          />
          <button 
            onClick={handleSendMessage}
            disabled={!input.trim() || !llmClient || isLoading}
          >
            {isLoading ? 'â³' : 'ğŸ’¬'}
          </button>
        </div>
      </div>
    </div>
  );
};
```

## ğŸ¨ æ ·å¼ç¤ºä¾‹

```css
/* å®ä¾‹çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
.instance-status {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 8px 12px;
  background: #f3f4f6;
  border-radius: 8px;
  margin-bottom: 16px;
  font-size: 14px;
}

.instance-name {
  font-weight: bold;
  color: #374151;
}

.status.connected {
  color: #059669;
}

.status.disconnected {
  color: #dc2626;
}

.model {
  color: #6b7280;
  font-family: monospace;
}

/* åŒºåŸŸåˆ†å‰²æ ·å¼ */
.ai-workspace {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 24px;
  padding: 24px;
}

.ai-workspace section {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 20px;
}

.summary-area {
  border-color: #3b82f6; /* è“è‰² - æ€»ç»“ */
}

.chat-area {
  border-color: #10b981; /* ç»¿è‰² - å¯¹è¯ */
}

.translate-area {
  border-color: #f59e0b; /* æ©™è‰² - ç¿»è¯‘ */
}
```

## ğŸ“Š ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | æ— å‘½åç®¡ç† | æœ‰å‘½åç®¡ç† |
|------|------------|------------|
| **ç»‘å®šæ¸…æ™°åº¦** | âŒ ä¸æ˜ç¡® | âœ… ä¸€ç›®äº†ç„¶ |
| **è°ƒè¯•éš¾åº¦** | âŒ å›°éš¾ | âœ… ç®€å• |
| **å¼€å‘ä½“éªŒ** | âŒ å®¹æ˜“æ··ä¹± | âœ… ç›´è§‚æ˜ç¡® |
| **ä»£ç å¯è¯»æ€§** | âŒ éœ€è¦æ¨æµ‹ | âœ… è‡ªæ–‡æ¡£åŒ– |
| **é”™è¯¯å®šä½** | âŒ éš¾ä»¥æ’æŸ¥ | âœ… å¿«é€Ÿå®šä½ |

## ğŸš€ å®é™…ä½¿ç”¨æ•ˆæœ

### æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹
```
âœ… document-summary æ€»ç»“å®Œæˆ
âœ… intelligent-chat å¯¹è¯å“åº”å®Œæˆ
âŒ multi-translate ç¿»è¯‘å¤±è´¥: API key not configured
```

### DOM ç»“æ„ç¤ºä¾‹
```html
<div class="document-summary" data-instance="document-summary">
  <div class="instance-status">
    <span class="instance-name">å®ä¾‹: document-summary</span>
    <span class="status connected">âœ… å·²è¿æ¥</span>
    <span class="model">æ¨¡å‹: gpt-4o-mini</span>
  </div>
  <!-- åŠŸèƒ½UI -->
</div>
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. **å‘½åè§„èŒƒ**
```tsx
// æ¨èï¼šåŠŸèƒ½-æ¨¡å¼ æ ¼å¼
<LlmConnectorProvider name="summary-economy" />
<LlmConnectorProvider name="chat-premium" />
<LlmConnectorProvider name="translate-multilang" />

// ä¸æ¨èï¼šè¿‡äºç®€å•
<LlmConnectorProvider name="a" />
<LlmConnectorProvider name="b" />
```

### 2. **è§†è§‰åŒºåˆ†**
```tsx
// ä¸ºä¸åŒå®ä¾‹ä½¿ç”¨ä¸åŒçš„è§†è§‰æ ·å¼
<div className={`feature-area ${instanceName}-theme`}>
```

### 3. **é”™è¯¯å¤„ç†**
```tsx
// åœ¨é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«å®ä¾‹åç§°
const handleError = (error: Error) => {
  console.error(`âŒ [${instanceName}] æ“ä½œå¤±è´¥:`, error);
  setError(`${instanceName} å®ä¾‹å‘ç”Ÿé”™è¯¯: ${error.message}`);
};
```

## ğŸ¯ æ€»ç»“

é€šè¿‡åå­—ç®¡ç†ä¸åŒå®ä¾‹çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š
- âœ… **è§£å†³ç»‘å®šæ··ä¹±** - æ¯ä¸ªç»„ä»¶éƒ½æ¸…æ¥šçŸ¥é“ä½¿ç”¨å“ªä¸ªclient
- âœ… **æå‡è°ƒè¯•ä½“éªŒ** - é”™è¯¯æ—¥å¿—å’ŒçŠ¶æ€éƒ½æœ‰æ˜ç¡®æ ‡è¯†
- âœ… **å¢å¼ºä»£ç å¯è¯»æ€§** - å®ä¾‹ç”¨é€”ä¸€ç›®äº†ç„¶
- âœ… **é™ä½å¼€å‘é—¨æ§›** - æ–°æ‰‹ä¹Ÿä¸å®¹æ˜“æé”™

è¿™å°±æ˜¯"é€šè¿‡ä¸åŒåå­—æ¥ç®¡ç†ä¸åŒå®ä¾‹"çš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼